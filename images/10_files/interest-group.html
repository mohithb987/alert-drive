<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <!-- Chrome origin trial token -->
    <meta http-equiv="origin-trial" content="AnolOEEMEnMaCvmUcw/eijaA/Ntx4pke43TW8O1+XFxTL7yMSzmBnkPrjQ33sKmqvREEpLQOE72gUMzHLu9KiAoAAABseyJvcmlnaW4iOiJodHRwczovL2NyaXRlby5jb206NDQzIiwiZmVhdHVyZSI6IlByaXZhY3lTYW5kYm94QWRzQVBJcyIsImV4cGlyeSI6MTY5NTE2Nzk5OSwiaXNTdWJkb21haW4iOnRydWV9">
    <title>Fledge IFrame</title>
</head>
<body>

<script>
    function getBswIg(src) {
        const elt = document.createElement("iframe");
        elt.allow = "join-ad-interest-group";
        elt.width = "0";
        elt.height = "0";
        elt.style.display = "none";
        elt.title = "BSW IG";
        elt.src = src;

        document.body.appendChild(elt);
    }

    if (!navigator.joinAdInterestGroup) {
        console.log("No fledge for you!");
    } else {
        var igs = [{"owner":"https://fledge.us.criteo.com","name":"jjZIw3xjY2kwbjBibnU2R3JFNmlNR012LzhnPT18","lifetimeMs":2592000000,"priorityVector":{"browserSignals.ageInMinutes":-1,"browserSignals.one":-86400},"biddingLogicURL":"https://fledge.us.criteo.com/simplebid?platform=us","biddingWasmHelperURL":"https://fledge.us.criteo.com/criteo.wasm","trustedBiddingSignalsURL":"https://fledge.us.criteo.com/getvalues","trustedBiddingSignalsKeys":["bvwennxVU0FwMHhDV2R4U2pBeXVnMzB5SFhQbk54cFN1clpPZGhCS3ExTk14Tm1QcDNDd1hIS0VVa3QwUERFMGlielhXa3RqQmFLdjlhdmd6TmVkbmptRlcvRUV6VmZzNjZBclpWZnVMZkFMNCtjVT18"],"maxTrustedBiddingSignalsURLLength":32768,"userBiddingSignals":{},"updateURL":"https://fledge.us.criteo.com/interest-group/update?key=ee1aPHxaWnQyK2ZIMkt0dWNkRG9SYU9MSHE1QTVDVXhiZTVqb3pkM0xwd0xMMTZOQzdJWGhwdm1PZW9xa0lSRHUwZzU5NkZBVFNDUnZuZ0ltSmZ3bWszaTJTaC81VjFoTWRvQmRHb0tIbzhCazU3UT18","ads":[],"adComponents":[],"trustedBiddingSignalsSlotSizeMode":"slot-size","executionMode":"group-by-origin","sellerCapabilities":{"*":["interest-group-counts","latency-stats"]}}];
        var expiration = 2592000;
        var errorEndpoint = "https://fledge.us.criteo.com/interest-group/error?pid=22344";
        if (navigator.joinAdInterestGroup.length == 1) {
            for (const ig of igs) {
                navigator.joinAdInterestGroup(ig).catch((e) => fetch(`${errorEndpoint}&message=${encodeError(e)}`));
            }
        } else {
            // This is for backwards-compatibility
            // The 1 - arg implementation is future - proof
            for (const ig of igs) {
                navigator.joinAdInterestGroup(ig, expiration).catch((e) => fetch(`${errorEndpoint}&message=${encodeError(e)}`));
            }
        }
        if (false) {
            getBswIg("https://dsp-paapi-sandbox.bsw-ig.criteo.com/paapi/dsp/html/index");
            getBswIg("https://paa-proxy-dsp.bsw-sb.criteo.com/paapi/paa-proxy/dsp/html/index/bsw-sb-ig-paa-proxy");
        }

        if (false) {
            callAuction();
        }
    }

    function encodeError(error) {
        return encodeURIComponent(error.name + ':' + error.message);
    }

    async function callAuction() {
        const owner = "https://fledge.us.criteo.com";

        const sellerJsUrl = `${owner}/interest-group/seller-js`;
        const response = await fetch(`${owner}/debug/test-signals?egid=11111`);
        const pbs = await response.json();

        const componentAuctionConf = {
            seller: owner,
            decisionLogicURL: sellerJsUrl,
            interestGroupBuyers: [owner],
            perBuyerSignals: pbs,
            perBuyerCumulativeTimeouts: {[owner]: 4000},
            perBuyerExperimentGroupIds: {[owner]: 11111},
            reportingTimeout: 5000 // max possible timeout (default 50)
        };

        const topAuctionConf = {
            seller: owner,
            decisionLogicURL: sellerJsUrl,
            componentAuctions: [componentAuctionConf]
        };

        const result = await navigator.runAdAuction(topAuctionConf);
    }

    async function measureAudienceSize() {
        // Measuring audience size
        // Register worklet
        if((!window?.sharedStorage?.worklet?.addModule) || (!window?.sharedStorage?.run)){
            return;
        }
        await window.sharedStorage.worklet.addModule('');

        // Run audience size measurement operation
        await window.sharedStorage.run('audience-size-measurement', {
            data: { bucketKey: BigInt('715012'), contributionValue: 8192}
        });
    }

    //TODO reactivate audience-size-measurement
    //measureAudienceSize();

</script>


</body></html>